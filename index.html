<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="愿你出走半生，归来依旧少年">
<meta property="og:type" content="website">
<meta property="og:title" content="NobiGo&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="NobiGo&#39;s blog">
<meta property="og:description" content="愿你出走半生，归来依旧少年">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NobiGo&#39;s blog">
<meta name="twitter:description" content="愿你出走半生，归来依旧少年">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>NobiGo's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">NobiGo's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/13/FinTech技术/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/13/FinTech技术/" itemprop="url">FenTech技术</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-13T10:13:48+08:00">
                2017-11-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/12/git总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/12/git总结/" itemprop="url">git总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-12T22:42:32+08:00">
                2017-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程技巧/" itemprop="url" rel="index">
                    <span itemprop="name">编程技巧</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>git rebase冲突解决方案</li>
</ol>
<p>在rebase过程中，也许会出现冲突，在这种情况下，git会停止rebase并会让你去解决冲突；在解决完冲突后，用“git -add”命令去更新这些内容的索引，然后，无需执行git-commit：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git rebase continue</div></pre></td></tr></table></figure>
<ol>
<li>git rebase原理</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git checkout dev</div><div class="line">git rebase -i  master</div></pre></td></tr></table></figure>
<p>这些命令会把dev分支中的每个提交取消掉，并且将他们保存为补丁（patch）（这些补丁放在“.git/rebase”目录中），然后把dev分支更新为最新的master分支，最后把保存的补丁应用到dev分支上。</p>
<p>作用：主要用在从上游分支获取最新commit信息，并有机的将当前分支和上游分支进行合并。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/05/POJO模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/05/POJO模式/" itemprop="url">POJO模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-05T10:49:37+08:00">
                2017-11-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>什么是POJO</li>
</ol>
<ul>
<li><p>POJO的名称有多种，pure old java object 、plain ordinary java object 等。</p>
</li>
<li><p>按照Martin Fowler的解释是“Plain Old Java Object”，从字面上翻译为“纯洁老式的java对象”，但大家都使用“简单java对象”来称呼它。</p>
</li>
</ul>
<ul>
<li>POJO的内在含义是指那些没有从任何类继承、也没有实现任何接口，更没有被其它框架侵入的java对象。</li>
</ul>
<ul>
<li>POCO的概念是从java的POJO借用而来，而两者的含义是一致的，不同的仅仅是使用的语言不一样。所以POCO的解释就是“Plain Old C# Object”。</li>
</ul>
<ol>
<li>为什么会有POJO？</li>
</ol>
<ul>
<li>主要是Java的开发者被EJB的繁杂搞怕了，大家经过反思，又回归“纯洁老式”的JavaBean，即有无参构造函数，每个字段都有getter和setter的java类。</li>
</ul>
<ol>
<li>POJO的意义</li>
</ol>
<ul>
<li>POJO让开发者可专注于业务逻辑和脱离框架的单元测试。除此之外， 由于POJO并不须要继承框架的类或实现其接口，开发者能够极其灵活地搭建继承结构和建造应用。</li>
</ul>
<ul>
<li><p>POJO的意义就在于它的简单而灵活性，因为它的简单和灵活，使得POJO能够任意扩展，从而胜任多个场合，也就让一个模型贯穿多个层成为现实。</p>
</li>
<li><p>先写一个核心POJO，然后实现业务逻辑接口和持久化接口，就成了Domain Model； UI需要使用时，就实现数据绑定接口，变成VO（View Object）。</p>
</li>
</ul>
<ol>
<li>POJO与POVO的区别</li>
</ol>
<ul>
<li><p>POJO是指简单java对象（Plain Old Java Objects、pure old java object 或者 plain ordinary java object）。</p>
</li>
<li><p>PO是指持久对象（persistant object持久对象）。</p>
</li>
<li><p>VO是指值对象或者View对象（Value Object、View Object）。注意，本文的VO特指View Object。</p>
</li>
</ul>
<ul>
<li><p>持久对象实际上必须对应数据库中的entity，所以和POJO有所区别。比如说POJO是由new创建，由GC回收。但是持久对象是insert数据库创建，由数据库delete删除的。基本上持久对象生命周期和数据库密切相关。另外持久对象往往只能存在一个数据库Connection之中，Connnection关闭以后，持久对象就不存在了，而POJO只要不被GC回收，总是存在的。</p>
</li>
<li><p>由于存在诸多差别，因此持久对象PO(Persistent Object)在代码上肯定和POJO不同，起码PO相对于POJO会增加一些用来管理数据库entity状态的属性和方法。而ORM追求的目标就是要PO在使用上尽量和POJO一致，对于程序员来说，他们可以把PO当做POJO来用，而感觉不到PO的存在。</p>
</li>
</ul>
<ol>
<li>POJO的扩展</li>
</ol>
<p>POJO仅包含最简单的字段属性，没有多余的东西，它本质上就是一个普通的JavaBean。</p>
<p>但是在POJO的基础上，能够扩展出不同的对象。</p>
<ul>
<li>为POJO增加了持久化的方法（Insert、Update、Delete……）之后，POJO就变成了PO。</li>
<li>为POJO增加了数据绑定功能之后，POJO就变成了View Object，即UI Model。</li>
<li>为POJO增加业务逻辑的方法（比如单据审核、转帐……）之后，POJO就变成了Domain Model。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/28/Spring概述/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/28/Spring概述/" itemprop="url">Spring概述</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-28T13:31:10+08:00">
                2017-10-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>Spring是分层的Java SE／EE应用一站式的轻量级开源框架，以IOC（控制反转）和AOP（切面编程）为内核，提供了展现层Spring MVC／持久层Spring JDBC以及业务层事务管理等一站式的企业级应用技术。</li>
<li>理念：好的设计优于具体实现，代码应易于测试</li>
<li>Spring好处：</li>
</ol>
<ul>
<li>方便节藕，简化开发。（控制反转IOC）</li>
<li>AOP编程的支持</li>
<li>声明式事务的支持</li>
<li>方便程序的测试</li>
<li>方便集成各种优秀的框架</li>
<li>降低Java API的难度</li>
</ul>
<ol>
<li>Spring框架结构</li>
</ol>
<img src="/2017/10/28/Spring概述/Spring框架结构.jpg" alt="Spring框架结构.jpg" title="">
<p><img src="/2017/10/28/Spring概述/Spring框架结构.jpg" alt="框架结构"></p>
<ol>
<li>Spring框架结构解释</li>
</ol>
<ul>
<li><p>持久层负责数据的访问和操作，Dao类被上层的业务类调用，从数据库表中加载数据并实例化领域对象，或将领域对象持久化到数据库表中</p>
</li>
<li><p>领域对象（实体类）：</p>
</li>
</ul>
<ol>
<li>它代表了业务的状态，切贯穿展现层／业务层／持久层</li>
<li>使数据库操作以面向对象的方式进行</li>
<li>注意：领域对象不一定等同于数据库表，不过对与简单的应用来说，可以使对等的</li>
</ol>
<h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><ul>
<li>SpringBoot更像一个管家，它会在后台“智能地”整个后项目所需地第三方依赖类库和框架。因此大部分基于Spring Boot的应用仅需很少的配置就可以运行。</li>
</ul>
<p>特性：</p>
<ol>
<li>快速上手</li>
<li>内置Tomcat和Jetty，可以独立运行</li>
<li>提供许多基于Maven的pom配置模板来简化工程配置</li>
<li>提供实现自动化配置的基础设施</li>
<li>提供可以直接在生产环境中使用的功能</li>
<li>开箱即用</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/13/《虚拟化与云计算》读书笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/13/《虚拟化与云计算》读书笔记/" itemprop="url">《虚拟化与云计算》读书笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-13T16:44:28+08:00">
                2017-10-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><ul>
<li>云计算</li>
</ul>
<p>将各种IT资源（计算资源、存储资源、软件开发、系统测试等）以服务的形式通过互联网交付给用户。</p>
<ul>
<li>虚拟化</li>
</ul>
<p>实现了IT资源的逻辑抽象和统一表示，在大规模数据中心管理和解决方案交付方面发挥着巨大的作用，是支撑云计算的技术基石。</p>
<h1 id="1-数据中心"><a href="#1-数据中心" class="headerlink" title="1. 数据中心"></a>1. 数据中心</h1><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><ol>
<li>当你在银行办理业务时，整个交易的流程都在银行的数据中心完成。</li>
<li>当你在互联网上冲浪搜索信息时，请求都悲哀搜索引擎的数据中心接收、处理和返回。</li>
</ol>
<h2 id="类比"><a href="#类比" class="headerlink" title="类比"></a>类比</h2><p>信息是血液，网络是血管，那么数据中心就是最关键的心脏，是信息世界的核心所在。</p>
<h2 id="1-1-数据中心概述"><a href="#1-1-数据中心概述" class="headerlink" title="1.1 数据中心概述"></a>1.1 数据中心概述</h2><h3 id="总的概述"><a href="#总的概述" class="headerlink" title="总的概述"></a>总的概述</h3><p>数据中心是信息系统的中心，通过网络向企业或公众提供信息服务。</p>
<h3 id="逻辑定义"><a href="#逻辑定义" class="headerlink" title="逻辑定义"></a>逻辑定义</h3><ul>
<li>硬件：数据中心的基础设施</li>
<li>软件：数据中心所安装的程序和提供的服务。</li>
</ul>
<p><img src="/images/数据中心逻辑示意图.PNG" alt="image"></p>
<h2 id="1-2-数据中心的设计和构建"><a href="#1-2-数据中心的设计和构建" class="headerlink" title="1.2 数据中心的设计和构建"></a>1.2 数据中心的设计和构建</h2><h3 id="总体设计"><a href="#总体设计" class="headerlink" title="总体设计"></a>总体设计</h3><ul>
<li>核心理念：简单、灵活、可扩展、模块化</li>
</ul>
<h3 id="建筑的设计和构建"><a href="#建筑的设计和构建" class="headerlink" title="建筑的设计和构建"></a>建筑的设计和构建</h3><ul>
<li>方式：租用机房、构建新的建筑作为数据中心</li>
</ul>
<ol>
<li>选址（通信、电力、地理位置）</li>
<li>建筑要求（规模、布局、高度、室内布局）</li>
</ol>
<h3 id="基础设施的设计和构建"><a href="#基础设施的设计和构建" class="headerlink" title="基础设施的设计和构建"></a>基础设施的设计和构建</h3><ul>
<li>网络（保证了服务器以及存储的互连和访问）</li>
<li>电力（数据中心运行的动力）</li>
<li>环境控制（合适的温度、湿度等环境）</li>
</ul>
<p><img src="/images/数据中心基础设施的设计和构建.PNG" alt="image"></p>
<p><img src="/images/数据中心风冷示意图.PNG" alt="image"></p>
<h3 id="数据中心上线"><a href="#数据中心上线" class="headerlink" title="数据中心上线"></a>数据中心上线</h3><ol>
<li>选择服务器（塔式服务器、机架式服务器、刀片服务器）</li>
</ol>
<ul>
<li><strong>塔式服务器</strong>：（和个人计算机的主机差不多）</li>
<li>优：接口和插槽比个人计算机多，成本低</li>
<li>缺：扩展性有限、占用空间较大</li>
</ul>
<p><img src="/images/塔式服务器.PNG" alt="image"></p>
<ul>
<li><strong>机架式服务器</strong>：（配合机柜使用的服务器）</li>
<li>优：占用空间较小、管理方便</li>
<li>缺：制冷要求高</li>
</ul>
<p><img src="/images/机架式服务器.PNG" alt="image"></p>
<ul>
<li><strong>刀片服务器</strong>：（在机箱上插装多个卡式的服务器单元）</li>
<li>优：支持热插拔、减少成本、节省空间</li>
</ul>
<p><img src="/images/刀片服务器.PNG" alt="image"></p>
<ol>
<li>选择软件</li>
</ol>
<ul>
<li>操作系统</li>
<li>数据中心管理监控软件</li>
<li>业务相关软件</li>
</ul>
<ol>
<li><p>机器上架</p>
</li>
<li><p>软件部署</p>
</li>
<li><p>测试</p>
</li>
</ol>
<h2 id="1-3-数据中心的管理和维护"><a href="#1-3-数据中心的管理和维护" class="headerlink" title="1.3 数据中心的管理和维护"></a>1.3 数据中心的管理和维护</h2><h3 id="硬件的管理和维护"><a href="#硬件的管理和维护" class="headerlink" title="硬件的管理和维护"></a>硬件的管理和维护</h3><h3 id="软件的管理和维护"><a href="#软件的管理和维护" class="headerlink" title="软件的管理和维护"></a>软件的管理和维护</h3><h3 id="数据的管理和维护（数据备份和恢复、数据整合、数据存档和数据挖掘等）"><a href="#数据的管理和维护（数据备份和恢复、数据整合、数据存档和数据挖掘等）" class="headerlink" title="数据的管理和维护（数据备份和恢复、数据整合、数据存档和数据挖掘等）"></a>数据的管理和维护（数据备份和恢复、数据整合、数据存档和数据挖掘等）</h3><h3 id="资源管理（负载均衡）"><a href="#资源管理（负载均衡）" class="headerlink" title="资源管理（负载均衡）"></a>资源管理（负载均衡）</h3><h3 id="安全管理"><a href="#安全管理" class="headerlink" title="安全管理"></a>安全管理</h3><h2 id="1-4-新一代的数据中心需求"><a href="#1-4-新一代的数据中心需求" class="headerlink" title="1.4 新一代的数据中心需求"></a>1.4 新一代的数据中心需求</h2><h3 id="合理规划（业务的动态性和不确定性会给数据中心的准确规划带来挑战）"><a href="#合理规划（业务的动态性和不确定性会给数据中心的准确规划带来挑战）" class="headerlink" title="合理规划（业务的动态性和不确定性会给数据中心的准确规划带来挑战）"></a>合理规划（业务的动态性和不确定性会给数据中心的准确规划带来挑战）</h3><h3 id="流程化"><a href="#流程化" class="headerlink" title="流程化"></a>流程化</h3><h3 id="可管理性（一个系统能够满足管理需求的能力以及管理该体统的便利程度）"><a href="#可管理性（一个系统能够满足管理需求的能力以及管理该体统的便利程度）" class="headerlink" title="可管理性（一个系统能够满足管理需求的能力以及管理该体统的便利程度）"></a>可管理性（一个系统能够满足管理需求的能力以及管理该体统的便利程度）</h3><ul>
<li>完备性</li>
<li>远程管理</li>
<li>集成控制台</li>
<li>快速响应</li>
<li>可追踪性</li>
<li>方便性</li>
<li>自动化</li>
</ul>
<h3 id="可伸缩性（适应负载变化的能力）"><a href="#可伸缩性（适应负载变化的能力）" class="headerlink" title="可伸缩性（适应负载变化的能力）"></a>可伸缩性（适应负载变化的能力）</h3><h3 id="可靠性（系统执行器功能的能力）"><a href="#可靠性（系统执行器功能的能力）" class="headerlink" title="可靠性（系统执行器功能的能力）"></a>可靠性（系统执行器功能的能力）</h3><h3 id="降低成本"><a href="#降低成本" class="headerlink" title="降低成本"></a>降低成本</h3><h3 id="节能环保"><a href="#节能环保" class="headerlink" title="节能环保"></a>节能环保</h3><h1 id="2-虚拟化技术概述"><a href="#2-虚拟化技术概述" class="headerlink" title="2. 虚拟化技术概述"></a>2. 虚拟化技术概述</h1><h2 id="2-1-虚拟化定义"><a href="#2-1-虚拟化定义" class="headerlink" title="2.1 虚拟化定义"></a>2.1 虚拟化定义</h2><p>虚拟内存技术：在磁盘存储空间划分一部分作为内存的中转空间，负责存储内存中存放不下且暂时不用的数据，当程序用到这些数据时，再将他们从磁盘换入内存。</p>
<p><strong>三层含义：</strong></p>
<ul>
<li>虚拟化的对象是各种各样的资源</li>
<li>经过虚拟化后的罗技资源对用户隐藏了不必要的细节</li>
<li>用户可以在虚拟环境中实现其在真实环境中的部分或者全部功能</li>
</ul>
<p>IBM定义：</p>
<p>1） 虚拟化是资源的逻辑表示，它不受物理限制的约束</p>
<p><img src="/images/包罗万象的虚拟化.PNG" alt="image"></p>
<h3 id="虚拟化的常见类型："><a href="#虚拟化的常见类型：" class="headerlink" title="虚拟化的常见类型："></a>虚拟化的常见类型：</h3><ul>
<li>基础设施虚拟化（网络虚拟化、存储虚拟化）</li>
<li>系统虚拟化（一台物理机运行多个独立的操作系统）</li>
</ul>
<p><img src="/images/系统虚拟化.PNG" alt="image"></p>
<ul>
<li>软件虚拟化（应用虚拟化、高级语言虚拟化）</li>
</ul>
<h2 id="2-2-服务器虚拟化"><a href="#2-2-服务器虚拟化" class="headerlink" title="2.2 服务器虚拟化"></a>2.2 服务器虚拟化</h2><p><img src="/images/服务器虚拟化.PNG" alt="image"></p>
<h3 id="虚拟化的典型实现"><a href="#虚拟化的典型实现" class="headerlink" title="虚拟化的典型实现"></a>虚拟化的典型实现</h3><p><img src="/images/服务器虚拟化的实现方式.PNG" alt="image"></p>
<h3 id="虚拟化的关键特性"><a href="#虚拟化的关键特性" class="headerlink" title="虚拟化的关键特性"></a>虚拟化的关键特性</h3><ul>
<li>多实例</li>
<li>隔离性</li>
<li>封装性</li>
<li>高性能</li>
</ul>
<h3 id="核心技术"><a href="#核心技术" class="headerlink" title="核心技术"></a>核心技术</h3><ul>
<li>CPU虚拟化</li>
</ul>
<p><img src="/images/x86体系结构下的软件CPU虚拟化.PNG" alt="image"></p>
<ul>
<li>内存虚拟化</li>
</ul>
<p><img src="/images/内存虚拟化.PNG" alt="image"></p>
<p><img src="/images/内存虚拟化的两种方法.PNG" alt="image"></p>
<ul>
<li>设备与I/O虚拟化</li>
</ul>
<p><img src="/images/设备与IO虚拟化.PNG" alt="image"></p>
<p><img src="/images/网络接口虚拟化.PNG" alt="image"></p>
<ul>
<li>虚拟机实时迁移</li>
</ul>
<p><img src="/images/实时迁移技术.PNG" alt="image"></p>
<h3 id="性能分析"><a href="#性能分析" class="headerlink" title="性能分析"></a>性能分析</h3><ul>
<li>把应用分为三种类型：</li>
</ul>
<ol>
<li>处理器密集型</li>
<li>内存密集型</li>
<li>输入/输出密集型</li>
</ol>
<h3 id="技术优势"><a href="#技术优势" class="headerlink" title="技术优势"></a>技术优势</h3><ol>
<li>降低运营成本</li>
<li>提高应用兼容性</li>
<li>加速应用部署</li>
<li>提高服务可用性</li>
<li>提升资源利用率</li>
<li>动态调度资源（实时迁移）</li>
<li>降低能源消耗（关闭利用率不高的服务器）</li>
</ol>
<h1 id="3-虚拟化的关键技术"><a href="#3-虚拟化的关键技术" class="headerlink" title="3. 虚拟化的关键技术"></a>3. 虚拟化的关键技术</h1><p><img src="/images/虚拟化解决方案生命周期示意图.PNG" alt="image"></p>
<h2 id="3-1-创建虚拟化解决方案"><a href="#3-1-创建虚拟化解决方案" class="headerlink" title="3.1 创建虚拟化解决方案"></a>3.1 创建虚拟化解决方案</h2><h3 id="创建基本虚拟镜像"><a href="#创建基本虚拟镜像" class="headerlink" title="创建基本虚拟镜像"></a>创建基本虚拟镜像</h3><ul>
<li><p>虚拟机是指通过虚拟化软件套件模拟的、具有完整硬件功能的、运行在一个隔离环境中的逻辑计算机系统。</p>
</li>
<li><p>虚拟镜像主要使用场景：开发和测试环境（方便使用虚拟镜像恢复到需要的状态）</p>
</li>
<li><p>虚拟镜像种类：停机状态下创建的镜像（磁盘数据）、运行过程中创建的镜像（磁盘数据+内存数据）</p>
</li>
<li><p>创建一个最基本的虚拟镜像的流程：</p>
</li>
</ul>
<ol>
<li>创建虚拟机</li>
<li>安装操作系统</li>
<li>关停虚拟机</li>
</ol>
<p><img src="/images/创建虚拟镜像示意图.PNG" alt="image"></p>
<h4 id="创建虚拟器件镜像（主要应用：软件发布）"><a href="#创建虚拟器件镜像（主要应用：软件发布）" class="headerlink" title="创建虚拟器件镜像（主要应用：软件发布）"></a>创建虚拟器件镜像（主要应用：软件发布）</h4><p>虚拟器件包括了预安装、预配置的操作系统、中间件和应用的最小化的虚拟机。</p>
<p><img src="/images/虚拟器件结构图.PNG" alt="image"></p>
<p><img src="/images/虚拟器件创建流程图.PNG" alt="image"></p>
<h4 id="发布虚拟器件镜像（统一标准：OVF）"><a href="#发布虚拟器件镜像（统一标准：OVF）" class="headerlink" title="发布虚拟器件镜像（统一标准：OVF）"></a>发布虚拟器件镜像（统一标准：OVF）</h4><p><img src="/images/OVF结构示意图.PNG" alt="image"></p>
<h4 id="管理虚拟器件镜像"><a href="#管理虚拟器件镜像" class="headerlink" title="管理虚拟器件镜像"></a>管理虚拟器件镜像</h4><p>镜像文件管理的目标：</p>
<ol>
<li>快速被检索到</li>
<li>减小公共仓库的磁盘使用量</li>
<li>对镜像进行版本控制</li>
</ol>
<p>在镜像管理系统上获取虚拟器件镜像的流程：</p>
<p><img src="/images/在镜像管理系统上获取虚拟器件镜像的流程.PNG" alt="image"></p>
<h4 id="迁移到虚拟化环境"><a href="#迁移到虚拟化环境" class="headerlink" title="迁移到虚拟化环境"></a>迁移到虚拟化环境</h4><ul>
<li>迁移服务存在的风险</li>
</ul>
<ol>
<li>开发人员的流动性，可能已经找不到以前开发团队的相关人员</li>
<li>服务队系统的兼容性问题</li>
</ol>
<p>P2V就是指物理到虚拟，它是指操作系统、应用程序和数据从物理计算机的运行环境迁移到虚拟环境中（整体性的解决方案避险了上述风险）。</p>
<p><img src="/images/P2V示意图.PNG" alt="image"></p>
<h2 id="3-2-部署虚拟化解决方案"><a href="#3-2-部署虚拟化解决方案" class="headerlink" title="3.2 部署虚拟化解决方案"></a>3.2 部署虚拟化解决方案</h2><h3 id="规划部署环境"><a href="#规划部署环境" class="headerlink" title="规划部署环境"></a>规划部署环境</h3><p>构建虚拟化环境的三个步骤：</p>
<ol>
<li>投资回报分析</li>
<li>资源规划（计算资源、存储资源和网络资源）</li>
<li>虚拟化平台厂商以及产品的选择</li>
</ol>
<h3 id="部署虚拟器件"><a href="#部署虚拟器件" class="headerlink" title="部署虚拟器件"></a>部署虚拟器件</h3><p><img src="/images/部署虚拟器件流程图.PNG" alt="image"></p>
<h3 id="激活虚拟器件"><a href="#激活虚拟器件" class="headerlink" title="激活虚拟器件"></a>激活虚拟器件</h3><p><img src="/images/自动化激活单个虚拟器件.PNG" alt="image"></p>
<h2 id="3-3-管理虚拟化解决方案"><a href="#3-3-管理虚拟化解决方案" class="headerlink" title="3.3 管理虚拟化解决方案"></a>3.3 管理虚拟化解决方案</h2><h3 id="集中监控"><a href="#集中监控" class="headerlink" title="集中监控"></a>集中监控</h3><ul>
<li>功能</li>
</ul>
<ol>
<li>能够集中监控数据中心的所有资源</li>
<li>能够集中监控所有的虚拟器件上运行的解决方案和流程</li>
</ol>
<h3 id="快捷管理"><a href="#快捷管理" class="headerlink" title="快捷管理"></a>快捷管理</h3><ul>
<li>管理员下达的管理指令主要针对三种类型的实体：</li>
</ul>
<ol>
<li>基础设施（开关物理机、配置网络）</li>
<li>虚拟机（开关虚拟机、调整虚拟机资源、迁移虚拟机、快照）</li>
<li>虚拟器件内的应用、软件、解决方案</li>
</ol>
<h3 id="动态优化"><a href="#动态优化" class="headerlink" title="动态优化"></a>动态优化</h3><ul>
<li>针对的问题：在虚拟化环境中，如何根据应用、服务负载的变化为其所在的虚拟机及时、有效地分配虚拟化环境中的资源，保证既不会因为资源缺乏而影响业务系统运行，也不会造成严重的资源浪费。</li>
</ul>
<h3 id="高效备份"><a href="#高效备份" class="headerlink" title="高效备份"></a>高效备份</h3><ul>
<li>主流的备份机制：</li>
</ul>
<ol>
<li>虚拟机上备份</li>
<li>虚拟机外备份</li>
</ol>
<h1 id="5-云计算技术概述"><a href="#5-云计算技术概述" class="headerlink" title="5. 云计算技术概述"></a>5. 云计算技术概述</h1><h2 id="5-1-元计算的概念"><a href="#5-1-元计算的概念" class="headerlink" title="5.1 元计算的概念"></a>5.1 元计算的概念</h2><h3 id="走近云计算"><a href="#走近云计算" class="headerlink" title="走近云计算"></a>走近云计算</h3><ul>
<li>相关案例</li>
</ul>
<p><img src="/images/云计算案例一.PNG" alt="image"></p>
<p><img src="/images/云计算案例二.PNG" alt="image"></p>
<h3 id="云计算的定义"><a href="#云计算的定义" class="headerlink" title="云计算的定义"></a>云计算的定义</h3><h4 id="云计算的来源"><a href="#云计算的来源" class="headerlink" title="云计算的来源"></a>云计算的来源</h4><ul>
<li>云计算名字来源：在互联网初期，用一朵云来表示互联网，选择一个名词来表示基于互联网的新一代计算方式就选择了“云计算”</li>
</ul>
<p><img src="/images/云计算中的云.PNG" alt="image"></p>
<h4 id="什么是云计算"><a href="#什么是云计算" class="headerlink" title="什么是云计算"></a>什么是云计算</h4><p>云计算是一种能够将动态伸缩的虚拟化资源通过互联网以服务的方式提供给用户的计算模式，用户不需要知道如何管理那些支持云计算的基础设施。</p>
<h4 id="云计算的特征"><a href="#云计算的特征" class="headerlink" title="云计算的特征"></a>云计算的特征</h4><p>在云计算的定义中，有四个关键要素：</p>
<ul>
<li>硬件和软件都是资源</li>
</ul>
<p><img src="/images/云计算的特征.PNG" alt="image"></p>
<ul>
<li>这些资源都可以根据需要进行动态扩展和配置</li>
<li>这些资源在物理上以分布式的共享方式存在，在最终在逻辑上以单一整体的形式呈现。</li>
</ul>
<h3 id="云计算的分类"><a href="#云计算的分类" class="headerlink" title="云计算的分类"></a>云计算的分类</h3><ul>
<li>按服务类型分类</li>
</ul>
<ol>
<li>基础设施云</li>
<li>平台云</li>
<li>应用云（为用户提供可以直接为其所用的应用）</li>
</ol>
<p><img src="/images/按服务类型划分云计算.PNG" alt="image"></p>
<ul>
<li>按服务方式分类（按照云计算提供者和使用者的所属关系为划分标准）</li>
</ul>
<ul>
<li>共有云（用户共享云提供商所拥有的资源）</li>
<li>私有云（为企业或组织锁专有的云计算换将）</li>
<li>混合云（公有云和私有云的混合）</li>
</ul>
<p><img src="/images/云计算的服务方式.PNG" alt="image"></p>
<h3 id="相关概念解析"><a href="#相关概念解析" class="headerlink" title="相关概念解析"></a>相关概念解析</h3><ul>
<li>并行计算</li>
</ul>
<p><img src="/images/并行计算.PNG" alt="image"></p>
<ul>
<li>网格计算 </li>
</ul>
<p><img src="/images/网格计算.PNG" alt="image"></p>
<ul>
<li>效用计算</li>
</ul>
<p><img src="/images/效用计算.PNG" alt="image"></p>
<h2 id="5-2-云计算的优势与带来的变革"><a href="#5-2-云计算的优势与带来的变革" class="headerlink" title="5.2 云计算的优势与带来的变革"></a>5.2 云计算的优势与带来的变革</h2><h4 id="云计算的优势"><a href="#云计算的优势" class="headerlink" title="云计算的优势"></a>云计算的优势</h4><ol>
<li>优化产业布局（将企业原先自给自足的IT运用模式改变为由云计算提供商按需供给的模式）</li>
<li>推进专业分工</li>
<li>提升资源利用率（与其他应用共享这个平台提供的服务和资源）</li>
<li>减少初期投资（云计算将代替传统的企业专有数据中心）</li>
<li>降低管理开销（一切工作交由云平台自动完成）</li>
</ol>
<h4 id="云计算带来的变革"><a href="#云计算带来的变革" class="headerlink" title="云计算带来的变革"></a>云计算带来的变革</h4><p><img src="/images/云计算产业结构中的角色.PNG" alt="image"></p>
<ol>
<li>硬件提供商</li>
<li>基础软件提供商（操作系统和中间件）</li>
<li>云提供商（向下采购（或者通过咨询服务的方式建议云服务提供商和企业机构用户采购））硬件提供商以及基础软件提供商的硬件和软件产品，向上为云服务提供商构建公有云的解决方案，为企业机构用户提供构建私有云的解决方案。）</li>
</ol>
<ul>
<li><ol>
<li>具有丰富的硬件系统集成经验</li>
</ol>
</li>
<li><ol>
<li>具有丰富的软件系统集成经验（硬件是云计算的躯体，软件是云计算的灵魂）</li>
</ol>
</li>
<li><ol>
<li>具有丰富的行业背景</li>
</ol>
</li>
</ul>
<ol>
<li>云服务提供商（提供适合市场需求的云计算环境）</li>
<li>应用提供商（所提供的服务运行在云中，并且是以服务的方式通过互联网提供的）</li>
<li>个人用户（从主要使用软件变为主要使用服务）</li>
<li>企业机构用户（不必在拥有自己的数据中心，降低成本）</li>
</ol>
<h2 id="5-3-云计算产生的原动力"><a href="#5-3-云计算产生的原动力" class="headerlink" title="5.3 云计算产生的原动力"></a>5.3 云计算产生的原动力</h2><p><img src="/images/云计算产生的原动力.PNG" alt="image"></p>
<h1 id="6-云架构"><a href="#6-云架构" class="headerlink" title="6. 云架构"></a>6. 云架构</h1><p>要保证所提供服务的可伸缩性、可用性和安全性</p>
<h2 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h2><h3 id="云架构的基本层次"><a href="#云架构的基本层次" class="headerlink" title="云架构的基本层次"></a>云架构的基本层次</h3><p>云计算中的云分为：基础设施云、云平台和应用云</p>
<p><img src="/images/云架构层次示意图.PNG" alt="image"></p>
<ul>
<li>基础设施层：经过虚拟化后的硬件资源和相关管理功能的集合。</li>
<li>平台层：基于基础设施层和应用层之间，它是具有通用型和可复用性软件资源的集合，为云应用提供了开发、运行、管理和监控的环境。</li>
<li>应用层：通过网络交付给用户 </li>
</ul>
<h3 id="云架构的服务层次"><a href="#云架构的服务层次" class="headerlink" title="云架构的服务层次"></a>云架构的服务层次</h3><ol>
<li>基础设施即服务</li>
</ol>
<ul>
<li>交付给用户的是基本的基础设施资源（存储、计算、网络）</li>
</ul>
<ol>
<li>平台即服务</li>
</ol>
<ul>
<li>交付给用户的是丰富的“云中间件”资源（应用容器、数据库和消息处理）</li>
<li>面向的用户不是普通的终端用户，而是软件开发人员，他们可以充分利用这些开放的资源来开发定制化的应用。</li>
</ul>
<ol>
<li>软件即服务</li>
</ol>
<ul>
<li><p>交付给用户的是定制化的软件</p>
</li>
<li><p>特征</p>
</li>
<li><ol>
<li>用户不需要在本地安装该软件的副本</li>
</ol>
</li>
<li><ol>
<li>软件通过服务的方式通过网络交付给用户</li>
</ol>
</li>
<li><ol>
<li>虽然是面向多个用户，但是每个用户都感觉是独自占有该服务</li>
</ol>
</li>
</ul>
<h2 id="6-2-基础设施层"><a href="#6-2-基础设施层" class="headerlink" title="6.2 基础设施层"></a>6.2 基础设施层</h2><h3 id="基础设施层的基本功能"><a href="#基础设施层的基本功能" class="headerlink" title="基础设施层的基本功能"></a>基础设施层的基本功能</h3><ul>
<li>功能（总）：能够使经过虚拟化后的计算济源、存储资源和网络资源能够以基础设施即服务的方式通过网络被用户使用和管理</li>
<li>功能（分）：</li>
</ul>
<ol>
<li>资源抽象</li>
<li>资源监控（负载管理的前提）</li>
<li>负载管理</li>
</ol>
<p><img src="/images/负载均衡效果.PNG" alt="image"></p>
<ol>
<li>数据管理（完整性、可靠性、可管理性）</li>
<li>资源部署（通过自动化部署流程将资源交付给上层应用的过程）</li>
</ol>
<ul>
<li>动态部署应用场景：</li>
<li><ol>
<li>动态可伸缩性</li>
</ol>
</li>
<li><ol>
<li>故障恢复和硬件维护</li>
</ol>
</li>
</ul>
<ol>
<li>安全管理（保证基础设施资源被合法的访问和使用）</li>
<li>计费管理（按量计费）</li>
</ol>
<h3 id="平台层"><a href="#平台层" class="headerlink" title="平台层"></a>平台层</h3><h4 id="平台层的基本功能"><a href="#平台层的基本功能" class="headerlink" title="平台层的基本功能"></a>平台层的基本功能</h4><ol>
<li>开发测试环境</li>
</ol>
<p><img src="/images/传统平台和云平台解决方案.PNG" alt="image"></p>
<ol>
<li>运行时环境（隔离性、可伸缩性和用户间隔离）</li>
<li>运营环境</li>
</ol>
<h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><p>种类：</p>
<ol>
<li>面向大众的标准应用</li>
<li>为了某个领域的客户而专门开发的客户应用</li>
<li>由第三方的独立软件开发商在云计算平台层上开发的满足用户多元化需求的应用</li>
</ol>
<p>特征：</p>
<ul>
<li>可以通过浏览器访问，或者具有开放的API，允许用户或者瘦客户端的调用</li>
<li>用户在使用云服务时，不需要进行一次性投入，只需要在使用的过程中按照其实际的使用情况付费</li>
<li>云应用要求高度整合</li>
</ul>
<h1 id="7-云计算的关键技术和挑战"><a href="#7-云计算的关键技术和挑战" class="headerlink" title="7. 云计算的关键技术和挑战"></a>7. 云计算的关键技术和挑战</h1><h2 id="7-1-云计算的关键技术"><a href="#7-1-云计算的关键技术" class="headerlink" title="7.1 云计算的关键技术"></a>7.1 云计算的关键技术</h2><h3 id="快速部署"><a href="#快速部署" class="headerlink" title="快速部署"></a>快速部署</h3><p><img src="/images/并行部署系统架构.PNG" alt="image"></p>
<h3 id="资源调度"><a href="#资源调度" class="headerlink" title="资源调度"></a>资源调度</h3><p><img src="/images/资源调度.PNG" alt="image"></p>
<h3 id="多租户技术"><a href="#多租户技术" class="headerlink" title="多租户技术"></a>多租户技术</h3><p><img src="/images/多租户技术.PNG" alt="image"></p>
<h3 id="海量数据处理"><a href="#海量数据处理" class="headerlink" title="海量数据处理"></a>海量数据处理</h3><p><img src="/images/mapreduce框架的基本处理流程.PNG" alt="image"></p>
<h3 id="大规模消息通信"><a href="#大规模消息通信" class="headerlink" title="大规模消息通信"></a>大规模消息通信</h3><h3 id="大规模分布式存储"><a href="#大规模分布式存储" class="headerlink" title="大规模分布式存储"></a>大规模分布式存储</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/11/逆序字符串的最长公共子序列长度/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/11/逆序字符串的最长公共子序列长度/" itemprop="url">逆序字符串的最长公共子序列长度</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-11T14:28:57+08:00">
                2017-10-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目：给出一个以空格作为分隔符的字符串，求其与其空格分割的逆序字符串的最长公共子序列长度。"><a href="#题目：给出一个以空格作为分隔符的字符串，求其与其空格分割的逆序字符串的最长公共子序列长度。" class="headerlink" title="题目：给出一个以空格作为分隔符的字符串，求其与其空格分割的逆序字符串的最长公共子序列长度。"></a>题目：给出一个以空格作为分隔符的字符串，求其与其空格分割的逆序字符串的最长公共子序列长度。</h1><h2 id="输入案例"><a href="#输入案例" class="headerlink" title="输入案例"></a>输入案例</h2><p>例如：</p>
<p>输入 2017 11 02</p>
<p>其逆序字符串为 02 11 2017</p>
<p>输出 6（2 11 2）</p>
<h2 id="动态规划法"><a href="#动态规划法" class="headerlink" title="动态规划法"></a>动态规划法</h2><p>经常会遇到复杂问题不能简单地分解成几个子问题，而会分解出一系列的子问题。简单地采用把大问题分解成子问题，并综合子问题的解导出大问题的解的方法，问题求解耗时会按问题规模呈幂级数增加。</p>
<p>为了节约重复求相同子问题的时间，引入一个数组，不管它们是否对最终解有用，把所有子问题的解存于该数组中，这就是动态规划法所采用的基本方法。</p>
<h3 id="最长公共子子序列问题（LCS-subSequence）"><a href="#最长公共子子序列问题（LCS-subSequence）" class="headerlink" title="最长公共子子序列问题（LCS_subSequence）"></a>最长公共子子序列问题（LCS_subSequence）</h3><p><strong>问题：</strong> 求两字符序列的最长公共字符子序列</p>
<p><strong>问题描述：</strong>字符序列的子序列是指从给定字符序列中随意地（不一定连续）去掉若干个字符（可能一个也不去掉）后所形成的字符序列。令给定的字符序列X=“x0，x1，…，xm-1”，序列Y=“y0，y1，…，yk-1”是X的子序列，存在X的一个严格递增下标序列[i0，i1，…，ik-1]，使得对所有的j=0，1，…，k-1，有xij=yj。例如，X=“ABCBDAB”，Y=“BCDB”是X的一个子序列。</p>
<p>考虑最长公共子序列问题如何分解成子问题，设A=“a0，a1，…，am-1”，B=“b0，b1，…，bm-1”，并Z=“z0，z1，…，zk-1”为它们的最长公共子序列。不难证明有以下性质：</p>
<ol>
<li><p>如果am-1=bn-1，则zk-1=am-1=bn-1，且“z0，z1，…，zk-2”是“a0，a1，…，am-2”和“b0，b1，…，bn-2”的一个最长公共子序列；</p>
</li>
<li><p>如果am-1!=bn-1，则若zk-1!=am-1，蕴涵“z0，z1，…，zk-1”是“a0，a1，…，am-2”和“b0，b1，…，bn-1”的一个最长公共子序列；</p>
</li>
<li><p>如果am-1!=bn-1，则若zk-1!=bn-1，蕴涵“z0，z1，…，zk-1”是“a0，a1，…，am-1”和“b0，b1，…，bn-2”的一个最长公共子序列。</p>
</li>
</ol>
<p>这样，在找A和B的公共子序列时，如有am-1=bn-1，则进一步解决一个子问题，找“a0，a1，…，am-2”和“b0，b1，…，bm-2”的一个最长公共子序列；如果am-1!=bn-1，则要解决两个子问题，找出“a0，a1，…，am-2”和“b0，b1，…，bn-1”的一个最长公共子序列和找出“a0，a1，…，am-1”和“b0，b1，…，bn-2”的一个最长公共子序列，再取两者中较长者作为A和B的最长公共子序列。</p>
<p><strong>求解</strong></p>
<p>引进一个二维数组c[][]，用c[i][j]记录X[i]与Y[j]的LCS的长度，b[i][j]记录c[i][j]是通过哪一个子问题的值求得的，以决定搜索的方向。<br>我们是自底向上进行递推计算，那么在计算c[i,j]之前，c[i-1][j-1]，c[i-1][j]与c[i][j-1]均已计算出来。此时我们根据X[i] = Y[j]还是X[i] != Y[j]，就可以计算出c[i][j]。 </p>
<p>问题的递归式写成： </p>
<p><img src="/images/逆序字符串的最长公共子序列长度.png" alt="image"></p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">package dx;</div><div class="line"></div><div class="line">import java.util.Scanner;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by dx on 2017/10/11.</div><div class="line"> */</div><div class="line">public class Qunaer &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        //用来记录长度</div><div class="line">        int count = 0;</div><div class="line">        Scanner scanner = new Scanner(System.in);</div><div class="line">        String string = scanner.nextLine();</div><div class="line"></div><div class="line">        String[] value = string.split(&quot; &quot;);</div><div class="line">        String[] reverseValue = new String[value.length];</div><div class="line"></div><div class="line">        for (int i = 0; i &lt; value.length; i++) &#123;</div><div class="line">            reverseValue[i] = new StringBuilder(value[i]).reverse().toString();</div><div class="line">        &#125;</div><div class="line">        StringBuilder stringBuilder = new StringBuilder();</div><div class="line">        for (int i = 0; i &lt; value.length; i++) &#123;</div><div class="line">            stringBuilder.append(reverseValue[i]);</div><div class="line">            if (i != value.length - 1)</div><div class="line">                stringBuilder.append(&quot; &quot;);</div><div class="line">        &#125;</div><div class="line">        String reverseString = stringBuilder.reverse().toString();</div><div class="line"></div><div class="line">        int[][] re = longestCommonSubsequence(string, reverseString);</div><div class="line">        System.out.println(re[string.length()][string.length()]);</div><div class="line">        print(re,string,reverseString,string.length(),reverseString.length());</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    // 假如返回两个字符串的最长公共子序列的长度</div><div class="line">    public static int[][] longestCommonSubsequence(String str1, String str2) &#123;</div><div class="line">        int[][] matrix = new int[str1.length() + 1][str2.length() + 1];//建立二维矩阵</div><div class="line">        // 初始化边界条件</div><div class="line">        for (int i = 0; i &lt;= str1.length(); i++) &#123;</div><div class="line">            matrix[i][0] = 0;//每行第一列置零</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        for (int j = 0; j &lt;= str2.length(); j++) &#123;</div><div class="line">            matrix[0][j] = 0;//每列第一行置零</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // 填充矩阵</div><div class="line">        for (int i = 1; i &lt;= str1.length(); i++) &#123;</div><div class="line">            for (int j = 1; j &lt;= str2.length(); j++) &#123;</div><div class="line">                if (str1.charAt(i - 1) == str2.charAt(j - 1)) &#123;</div><div class="line">                    matrix[i][j] = matrix[i - 1][j - 1] + 1;</div><div class="line">                &#125; else &#123;</div><div class="line">                    matrix[i][j] = (matrix[i - 1][j] &gt;= matrix[i][j - 1] ? matrix[i - 1][j]</div><div class="line">                            : matrix[i][j - 1]);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return matrix;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //根据矩阵输出LCS</div><div class="line">    public static void print(int[][] opt, String X, String Y, int i, int j) &#123;</div><div class="line">        if (i == 0 || j == 0) &#123;</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        if (X.charAt(i - 1) == Y.charAt(j - 1)) &#123;</div><div class="line">            print(opt, X, Y, i - 1, j - 1);</div><div class="line">            System.out.print(X.charAt(i - 1));</div><div class="line">        &#125; else if (opt[i - 1][j] &gt;= opt[i][j]) &#123;</div><div class="line">            print(opt, X, Y, i - 1, j);</div><div class="line">        &#125; else &#123;</div><div class="line">            print(opt, X, Y, i, j - 1);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/26/Java参数传递/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/26/Java参数传递/" itemprop="url">Java参数传递</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-26T14:41:53+08:00">
                2017-09-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpecialNote/" itemprop="url" rel="index">
                    <span itemprop="name">SpecialNote</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>JAVA属于值传递还是引用传递？</p>
<p>不管你传的是什么,传过去的都只是一个副本而已,这个副本作为方法的局部变量保存在栈中。</p>
<p>如果传的是基本数据类型,修改这个值并不会影响作为参数传进来的那个变量,因为你修改的是方法的局部变量,是一个副本。</p>
<p>如果传的是一个对象的引用,也是一样的,也是一个副本,但是这个副本和作为参数传进来的那个引用指向的是内存中的同一个对象,所以你通过这个副本也可以操作那个对象。但是如果你修改这个引用本身,比如让他指向内存中的另外一个对象,原来作为参数传进来的那个引用不会受到影响。</p>
<p>我觉得弄明白这些就行了,说值传递或引用传递都无所谓,但是说值传递更适合一些,这个值可以是引用也可以是基本数据类型。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/22/正确实现Java中的HashCode-一致性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/22/正确实现Java中的HashCode-一致性/" itemprop="url">正确实现Java中的HashCode-一致性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-22T14:19:13+08:00">
                2017-09-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpecialNote/" itemprop="url" rel="index">
                    <span itemprop="name">SpecialNote</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>默认情况下，用户自定义实现HashCode时，它们会使用相同的字段，但有一个细节需要考虑。</p>
<h1 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h1><p>第一是一致性要求。它应该经过非常严格的计算。如果有字段产生了变化，哈希码也应该允许变化（对于可变类来说，这往往是不可避免的），依赖哈希的数据结构并未准备应付这种情况。</p>
<p>正如我们所知哈希码用于确定一个元素的桶，但是如果哈希相关的字段发生变化，并不会立即重新计算哈希码，而且内部的数组也不会更新。</p>
<p>这就意味着，再对一个相等的对象甚至同一个对象的查询会失败！这个数据结构会计算当前的哈希码，这个哈希码与实例存入时的哈希码并不相同，这直接导致找错了桶。</p>
<p><strong>小结：最好不要用可变的字段来计算哈希码！</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/22/Java高并发：锁概览/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/22/Java高并发：锁概览/" itemprop="url">Java高并发：锁概览</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-22T13:52:48+08:00">
                2017-09-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/高并发/" itemprop="url" rel="index">
                    <span itemprop="name">高并发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在学习或者使用Java的过程中进程会遇到各种各样的锁的概念：公平锁、非公平锁、自旋锁、可重入锁、偏向锁、轻量级锁、重量级锁、读写锁、互斥锁等待。这里整理了Java中的各种锁，若有不足之处希望大家在下方留言探讨。</p>
<h1 id="公平锁和非公平锁"><a href="#公平锁和非公平锁" class="headerlink" title="公平锁和非公平锁"></a>公平锁和非公平锁</h1><p>公平锁是指多个线程在等待同一个锁时，必须按照申请锁的先后顺序来一次获得锁。</p>
<p>公平锁的好处是等待锁的线程不会饿死，但是整体效率相对低一些；非公平锁的好处是整体效率相对高一些，但是有些线程可能会饿死或者说很早就在等待锁，但要等很久才会获得锁。其中的原因是公平锁是严格按照请求所的顺序来排队获得锁的，而非公平锁时可以抢占的，即如果在某个时刻有线程需要获取锁，而这个时候刚好锁可用，那么这个线程会直接抢占，而这时阻塞在等待队列的线程则不会被唤醒。</p>
<p>公平锁可以使用new ReentrantLock(true)实现。</p>
<h1 id="自旋锁"><a href="#自旋锁" class="headerlink" title="自旋锁"></a>自旋锁</h1><p>Java的线程是映射到操作系统的原生线程之上的，如果要阻塞或唤醒一个线程，都需要操作系统来帮忙完成，这就需要从用户态转换到核心态中，因此状态装换需要耗费很多的处理器时间，<strong>对于代码简单的同步块（如被synchronized修饰的getter()和setter()方法），状态转换消耗的时间有可能比用户代码执行的时间还要长。</strong></p>
<p>虚拟机的开发团队注意到在许多应用上，共享数据的锁定状态只会持续很短的一段时间，为了这段时间挂起和恢复现场并不值得。如果物理机器有一个以上的处理器，能让两个或以上的线程同时并行执行，我们就可以让后面请求锁的那个线程“稍等一下“，但不放弃处理器的执行时间，看看持有锁的线程是否很快就会释放锁。<strong>为了让线程等待，我们只需让线程执行一个忙循环（自旋），这项技术就是所谓的自旋锁。</strong></p>
<p>自旋等待不能代替阻塞。<strong>自旋等待本身虽然避免了线程切换的开销，但它是要占用处理器时间的，因此，如果锁被占用的时间很短，自旋当代的效果就会非常好，反之，如果锁被占用的时间很长，那么自旋的线程只会拜拜浪费处理器资源。</strong>因此，自旋等待的时间必须要有一定的限度，如果自旋超过了限定次数（默认是10次，可以使用-XX:PreBlockSpin来更改）没有成功获得锁，就应当使用传统的方式去挂起线程了。</p>
<p>自旋锁在JDK1.4.2中引入，使用-XX:+UseSpinning来开启。JDK6中已经变为默认开启，并且引入了自适应的自旋锁。自适应意味着自旋的时间不在固定了，而是由前一次在同一个锁上的自旋时间及锁的拥有者的状态来决定。</p>
<p><strong>自旋是在轻量级锁中使用的，在重量级锁中，线程不使用自旋。</strong></p>
<p><strong>如果在同一个锁对象上，自旋等待刚刚成功获得过锁，并且持有锁的线程正在运行中，那么虚拟机就会认为这次自旋也是很有可能再次成功，进而它将允许自旋等待持续相对更长的时间，比如100次循环。另外，如果对于某个锁，自旋很少成功获得过，那在以后要获取这个锁时将可能省略掉自旋过程，以避免浪费处理器资源。</strong></p>
<h1 id="锁消除"><a href="#锁消除" class="headerlink" title="锁消除"></a>锁消除</h1><p>锁消除是虚拟机JIT在运行时，对一些代码上要求同步，但是被检测到不可能存在共享数据竞争的锁进行消除。锁消除的主要判断依据是来源于<strong>逃逸分析</strong>的数据支持，<strong>如果判断在一段代码中，堆上的所有数据都不会逃逸出去从而能被其他线程访问到，那就可以把他们当做栈上数据对待，认为他们是线程私有的，同步加锁自然就无需进行。</strong></p>
<p>来看这样一个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public String concatString(String s1, String s2, String s3)</div><div class="line">   &#123;</div><div class="line">       StringBuffer sb = new StringBuffer();</div><div class="line">       sb.append(s1);</div><div class="line">       sb.append(s2);</div><div class="line">       sb.append(s3);</div><div class="line">       return sb.toString();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>可以知道StringBuffer(线程安全的)的append方法定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public synchronized StringBuffer append(StringBuffer sb) &#123;</div><div class="line">        super.append(sb);</div><div class="line">        return this;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>也就是说在append方法中涉及了同步操作。但是可以观察到sb对象它的作用域被限制在方法的内部，也就是sb对象不会“逃逸”出去，其他线程无法访问。因此，虽然这里有锁，但是可以被安全的消除，在即时编译之后，这段代码就会忽略掉所有的同步而直接执行了。</p>
<h1 id="锁粗化"><a href="#锁粗化" class="headerlink" title="锁粗化"></a>锁粗化</h1><p>原则上，我们在编写代码的时候，总是推荐将同步块的作用范围限制的尽量小——只在共享数据的实际作用域中才进行同步，这样是为了使得需要同步的操作数量尽可能变小，如果存在锁禁止，那等待的线程也能尽快拿到锁。大部分情况下，这些都是正确的。<strong>但是，如果一些列的联系操作都是同一个对象反复加上和解锁，甚至加锁操作是出现在循环体中的，那么即使没有线程竞争，频繁地进行互斥同步操作也导致不必要的性能损耗。</strong></p>
<p>举个案例，类似锁消除的append()方法。如果StringBuffer sb = new StringBuffer();定义在方法体之外，那么就会有线程竞争，但是每个append()操作都对同一个对象反复加锁解锁，那么虚拟机探测到有这样的情况的话，会把加锁同步的范围扩展到整个操作序列的外部，即扩展到第一个append()操作之前和最后一个append()操作之后，这样的一个锁范围扩展的操作就称之为锁粗化。</p>
<h1 id="可重入锁"><a href="#可重入锁" class="headerlink" title="可重入锁"></a>可重入锁</h1><p>可重入锁，也叫做递归锁，指的是同一线程外层函数获得锁之后 ，内层递归函数仍然有获取该锁的代码，但不受影响。</p>
<p>在JAVA环境下 ReentrantLock 和synchronized 都是可重入锁。可重入锁最大的作用是避免死锁。</p>
<h2 id="类锁和对象锁"><a href="#类锁和对象锁" class="headerlink" title="类锁和对象锁"></a>类锁和对象锁</h2><p>类锁：在方法上加上static synchronized的锁，或者synchronized(xxx.class)的锁。如下代码中的method1和method2：</p>
<p>对象锁：参考method4, method5,method6.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public class LockStrategy</div><div class="line">&#123;</div><div class="line">    //对象</div><div class="line">    public Object object1 = new Object();</div><div class="line">    //类锁</div><div class="line">    public static synchronized void method1()&#123;&#125;</div><div class="line">    //类锁</div><div class="line">    public void method2()&#123;</div><div class="line">        synchronized(LockStrategy.class)&#123;&#125;</div><div class="line">    &#125;</div><div class="line">    //对象锁</div><div class="line">    public synchronized void method4()&#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    //对象锁</div><div class="line">    public void method5()</div><div class="line">    &#123;</div><div class="line">        synchronized(this)&#123;&#125;</div><div class="line">    &#125;</div><div class="line">    //对象锁</div><div class="line">    public void method6()</div><div class="line">    &#123;</div><div class="line">        synchronized(object1)&#123;&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面做一道习题来加深一下对对象锁和类锁的理解.<br>有一个类这样定义:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class SynchronizedTest</div><div class="line">&#123;</div><div class="line">    public synchronized void method1()&#123;&#125;</div><div class="line">    public synchronized void method2()&#123;&#125;</div><div class="line">    public static synchronized void method3()&#123;&#125;</div><div class="line">    public static synchronized void method4()&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么，有SynchronizedTest的两个实例a和b，对于一下的几个选项有哪些能被一个以上的线程同时访问呢？(BE)</p>
<ul>
<li>A. a.method1()(对象锁) vs. a.method2()(对象锁)</li>
<li>B. a.method1()(对象锁) vs. b.method1()(对象锁)</li>
<li>C. a.method3()(类锁) vs. b.method4()(类锁)</li>
<li>D. a.method3()(类锁) vs. b.method3()(类锁)</li>
<li>E. a.method1()(对象锁) vs. a.method3()(类锁)</li>
</ul>
<h1 id="偏向锁、轻量级锁和重量级锁"><a href="#偏向锁、轻量级锁和重量级锁" class="headerlink" title="偏向锁、轻量级锁和重量级锁"></a>偏向锁、轻量级锁和重量级锁</h1><p>synchronized的偏向锁、轻量级锁以及重量级锁是通过Java对象头实现的。博主在Java对象大小内幕浅析中提到了Java对象的内存布局分为：对象头、实例数据和对其填充，而对象头又可以分为”Mark Word”和类型指针klass。”Mark Word”是关键，默认情况下，其存储对象的HashCode、分代年龄和锁标记位。</p>
<p>这里说的都是以HotSpot虚拟机为基准的。首先来看一下”Mark Word”的内容：</p>
<table>
<thead>
<tr>
<th>锁状态</th>
<th>存储内容</th>
<th>标志位</th>
</tr>
</thead>
<tbody>
<tr>
<td>无锁</td>
<td>对象的hashCode、对象分代年龄、是否是偏向锁（0）</td>
<td>01</td>
</tr>
<tr>
<td>轻量级</td>
<td>指向栈中锁记录的指针</td>
<td>00</td>
</tr>
<tr>
<td>重量级</td>
<td>指向互斥量（重量级锁）的指针</td>
<td>10</td>
</tr>
<tr>
<td>GC标记</td>
<td>（空）</td>
<td>11</td>
</tr>
<tr>
<td>偏向锁</td>
<td>偏向线程ID、偏向时间戳、对象分代年龄、是否是偏向锁（1）</td>
<td>01</td>
</tr>
</tbody>
</table>
<p>偏向锁是JDK6中引入的一项锁优化，它的目的是消除数据在无竞争情况下的同步原语，进一步提高程序的运行性能。</p>
<p>偏向锁会偏向于第一个获得它的线程，如果在接下来的执行过程中，该锁没有被其他的线程获取，则持有偏向锁的线程将永远不需要同步。大多数情况下，锁不仅不存在多线程竞争，而且总是由同一线程多次获得，为了让线程获得锁的代价更低而引入了偏向锁。</p>
<p>当锁对象第一次被线程获取的时候，线程使用CAS操作把这个锁的线程ID记录再对象Mark Word之中，同时置偏向标志位1。以后该线程在进入和退出同步块时不需要进行CAS操作来加锁和解锁，只需要简单地测试一下对象头的Mark Word里是否存储着指向当前线程的偏向锁。如果测试成功，表示线程已经获得了锁。</p>
<p>如果线程使用CAS操作时失败则表示该锁对象上存在竞争并且这个时候另外一个线程获得偏向锁的所有权。当到达全局安全点（safepoint，这个时间点上没有正在执行的字节码）时获得偏向锁的线程被挂起，膨胀为轻量级锁（涉及Monitor Record，Lock Record相关操作，这里不展开），同时被撤销偏向锁的线程继续往下执行同步代码。</p>
<p>当有另外一个线程去尝试获取这个锁时，偏向模式就宣告结束。</p>
<p>线程在执行同步块之前，JVM会先在当前线程的栈帧中创建用于存储锁记录(Lock Record)的空间，并将对象头中的Mard Word复制到锁记录中，官方称为Displaced Mark Word。然后线程尝试使用CAS将对象头中的Mark Word替换为指向锁记录的指针。如果成功，当前线程获得锁，如果失败，表示其他线程竞争锁，当前线程便尝试使用自旋来获取锁。如果自旋失败则锁会膨胀成重量级锁。如果自旋成功则依然处于轻量级锁的状态。</p>
<p>轻量级锁的解锁过程也是通过CAS操作来进行的，如果对象的Mark Word仍然指向线程的锁记录，那就用CAS操作把对象当前的Mark Word和线程中赋值的Displaced Mark Word替换回来，如果替换成功，整个同步过程就完成了，如果替换失败，就说明有其他线程尝试过获取该锁，那就要在释放锁的同时，唤醒被挂起的线程。</p>
<p>轻量级锁提升程序同步性能的依据是：对于绝大部分的锁，在整个同步周期内都是不存在竞争的（区别于偏向锁）。这是一个经验数据。如果没有竞争，轻量级锁使用CAS操作避免了使用互斥量的开销，但如果存在锁竞争，除了互斥量的开销外，还额外发生了CAS操作，因此在有竞争的情况下，轻量级锁比传统的重量级锁更慢。</p>
<p>整个synchronized锁流程如下：</p>
<ol>
<li>检测Mark Word里面是不是当前线程的ID，如果是，表示当前线程处于偏向锁</li>
<li>如果不是，则使用CAS将当前线程的ID替换Mard Word，如果成功则表示当前线程获得偏向锁，置偏向标志位1</li>
<li>如果失败，则说明发生竞争，撤销偏向锁，进而升级为轻量级锁。</li>
<li>当前线程使用CAS将对象头的Mark Word替换为锁记录指针，如果成功，当前线程获得锁</li>
<li>如果失败，表示其他线程竞争锁，当前线程便尝试使用自旋来获取锁。</li>
<li>如果自旋成功则依然处于轻量级状态。</li>
<li>如果自旋失败，则升级为重量级锁。</li>
</ol>
<h1 id="悲观锁和乐观锁"><a href="#悲观锁和乐观锁" class="headerlink" title="悲观锁和乐观锁"></a>悲观锁和乐观锁</h1><p>悲观锁：假定会发生并发冲突，屏蔽一切可能违反数据完整性的操作。<br>乐观锁：假定不会发生并发冲突，只在提交操作时检测是否违反数据完整性。（使用版本号或者时间戳来配合实现）</p>
<h1 id="共享锁和排它锁"><a href="#共享锁和排它锁" class="headerlink" title="共享锁和排它锁"></a>共享锁和排它锁</h1><p>共享锁：如果事务T对数据A加上共享锁后，则其他事务只能对A再加共享锁，不能加排它锁。获准共享锁的事务只能读数据，不能修改数据。<br>排它锁：如果事务T对数据A加上排它锁后，则其他事务不能再对A加任何类型的锁。获得排它锁的事务即能读数据又能修改数据。</p>
<h1 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h1><p>读写锁是一个资源能够被多个读线程访问，或者被一个写线程访问但不能同时存在读线程。Java当中的读写锁通过ReentrantReadWriteLock实现。具体使用方法这里不展开。</p>
<h1 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h1><p>所谓互斥锁就是指一次最多只能有一个线程持有的锁。在JDK中synchronized和JUC的Lock就是互斥锁。</p>
<h1 id="无锁"><a href="#无锁" class="headerlink" title="无锁"></a>无锁</h1><p>要保证现场安全，并不是一定就要进行同步，两者没有因果关系。同步只是保证共享数据争用时的正确性的手段，如果一个方法本来就不涉及共享数据，那它自然就无须任何同步措施去保证正确性，因此会有一些代码天生就是线程安全的。</p>
<ol>
<li>无状态编程。无状态代码有一些共同的特征：不依赖于存储在对上的数据和公用的系统资源、用到的状态量都由参数中传入、不调用非无状态的方法等。可以参考Servlet。</li>
<li>线程本地存储。可以参考ThreadLocal</li>
<li>volatile</li>
<li>CAS</li>
<li>协程：在单线程里实现多任务的调度，并在单线程里维持多个任务间的切换。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/22/Java高并发：ReentrantLock-重入锁-以及公平性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NobiGo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/雄.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NobiGo's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/22/Java高并发：ReentrantLock-重入锁-以及公平性/" itemprop="url">Java高并发：ReentrantLock(重入锁)以及公平性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-22T13:47:47+08:00">
                2017-09-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/高并发/" itemprop="url" rel="index">
                    <span itemprop="name">高并发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><strong>ReentrantLock</strong>的实现不仅可以替代隐式的synchronized关键字，而且能够提供超过关键字本身的多种功能。</p>
<p>这里提到一个锁获取的公平性问题，如果在绝对时间上，先对锁进行获取的请求一定被先满足，那么这个锁是公平的，反之，是不公平的，也就是说等待时间最长的线程最有机会获取锁，也可以说锁的获取是有序的。ReentrantLock这个锁提供了一个构造函数，能够控制这个锁是否是公平的。</p>
<p>而锁的名字也是说明了这个锁具备了重复进入的可能，也就是说能够让当前线程多次的进行对锁的获取操作，这样的最大次数限制是Integer.MAX_VALUE，约21亿次左右。</p>
<p>事实上<strong>公平的锁机制往往没有非公平的效率高</strong>，因为公平的获取锁没有考虑到操作系统对线程的调度因素，这样造成JVM对于等待中的线程调度次序和操作系统对线程的调度之间的不匹配。对于锁的快速且重复的获取过程中，连续获取的概率是非常高的，而公平锁会压制这种情况，虽然公平性得以保障，但是响应比却下降了，但是并不是任何场景都是以TPS作为唯一指标的，因为公平锁能够减少“饥饿”发生的概率，等待越久的请求越是能够得到优先满足。</p>
<p><strong>可重入锁的最大作用：避免死锁</strong></p>
<h1 id="Java应用"><a href="#Java应用" class="headerlink" title="Java应用"></a>Java应用</h1><p>可重入锁，也叫做递归锁，指的是同一线程外层函数获得锁之后,内层递归函数仍然有获取该锁的代码，但不受影响。</p>
<p><strong>在JAVA环境下 ReentrantLock 和synchronized 都是 可重入锁</strong></p>
<h3 id="synchronized-Demo"><a href="#synchronized-Demo" class="headerlink" title="synchronized Demo"></a>synchronized Demo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">package dx.concurrent.reentrantlock;</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by dx on 2017/9/12.</div><div class="line"> */</div><div class="line">public class Test1 implements Runnable &#123;</div><div class="line"></div><div class="line">    public synchronized void get() &#123;</div><div class="line">        System.out.println(Thread.currentThread().getId());</div><div class="line">        set();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public synchronized void set() &#123;</div><div class="line">        System.out.println(Thread.currentThread().getId());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        get();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Test1 ss = new Test1();</div><div class="line">        new Thread(ss).start();</div><div class="line">        new Thread(ss).start();</div><div class="line">        new Thread(ss).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">10</div><div class="line">10</div><div class="line">12</div><div class="line">12</div><div class="line">11</div><div class="line">11</div></pre></td></tr></table></figure>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">package dx.concurrent.reentrantlock;</div><div class="line"></div><div class="line">import java.util.concurrent.locks.ReentrantLock;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by dx on 2017/9/12.</div><div class="line"> */</div><div class="line">public class Test2 implements Runnable &#123;</div><div class="line">    ReentrantLock lock = new ReentrantLock();</div><div class="line"></div><div class="line">    public void get() &#123;</div><div class="line">        lock.lock();</div><div class="line">        System.out.println(Thread.currentThread().getId());</div><div class="line">        set();</div><div class="line">        lock.unlock();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void set() &#123;</div><div class="line">        lock.lock();</div><div class="line">        System.out.println(Thread.currentThread().getId());</div><div class="line">        lock.unlock();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        get();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Test2 ss = new Test2();</div><div class="line">        new Thread(ss).start();</div><div class="line">        new Thread(ss).start();</div><div class="line">        new Thread(ss).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">10</div><div class="line">10</div><div class="line">12</div><div class="line">12</div><div class="line">11</div><div class="line">11</div></pre></td></tr></table></figure>
<h1 id="实现分析"><a href="#实现分析" class="headerlink" title="实现分析"></a>实现分析</h1><p>在ReentrantLock中，对于公平和非公平的定义是通过对同步器<strong>AbstractQueuedSynchronizer</strong>的扩展加以实现的，也就是在tryAcquire的实现上做了语义的控制。</p>
<h2 id="非公平实现语义"><a href="#非公平实现语义" class="headerlink" title="非公平实现语义"></a>非公平实现语义</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">final boolean nonfairTryAcquire(int acquires) &#123;</div><div class="line">           final Thread current = Thread.currentThread();</div><div class="line">           int c = getState();</div><div class="line">           //当前状态为初试状态，尝试设置初试状态</div><div class="line">           if (c == 0) &#123;</div><div class="line">               if (compareAndSetState(0, acquires)) &#123;</div><div class="line">                   setExclusiveOwnerThread(current);</div><div class="line">                   //如果状态设置成功后就返回</div><div class="line">                   return true;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           //如果状态被设置，且获取锁的线程又是当前线程的时候，进行状态的自增；</div><div class="line">           else if (current == getExclusiveOwnerThread()) &#123;</div><div class="line">               int nextc = c + acquires;</div><div class="line">               if (nextc &lt; 0) // overflow</div><div class="line">                   throw new Error(&quot;Maximum lock count exceeded&quot;);</div><div class="line">               setState(nextc);</div><div class="line">               return true;</div><div class="line">           &#125;</div><div class="line">           //如果未设置成功状态且当前线程不是获取锁的线程，那么返回失败。</div><div class="line">           return false;</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<h3 id="公平的实现语义"><a href="#公平的实现语义" class="headerlink" title="公平的实现语义"></a>公平的实现语义</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">protected final boolean tryAcquire(int acquires) &#123;</div><div class="line">	final Thread current = Thread.currentThread();</div><div class="line">	int c = getState();</div><div class="line">	if (c == 0) &#123;</div><div class="line">	//判断当前线程是否有前置线程在等待</div><div class="line">		if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123;</div><div class="line">			setExclusiveOwnerThread(current);</div><div class="line">			return true;</div><div class="line">		&#125;</div><div class="line">	&#125; else if (current == getExclusiveOwnerThread()) &#123;</div><div class="line">		int nextc = c + acquires;</div><div class="line">		if (nextc &lt; 0)</div><div class="line">			throw new Error(&quot;Maximum lock count exceeded&quot;);</div><div class="line">		setState(nextc);</div><div class="line">		return true;</div><div class="line">	&#125;</div><div class="line">	return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="释放语义"><a href="#释放语义" class="headerlink" title="释放语义"></a>释放语义</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">protected final boolean tryRelease(int releases) &#123;</div><div class="line">	int c = getState() - releases;</div><div class="line">	if (Thread.currentThread() != getExclusiveOwnerThread())</div><div class="line">		throw new IllegalMonitorStateException();</div><div class="line">	boolean free = false;</div><div class="line">	if (c == 0) &#123;</div><div class="line">		free = true;</div><div class="line">		setExclusiveOwnerThread(null);</div><div class="line">	&#125;</div><div class="line">	setState(c);</div><div class="line">	return free;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述逻辑主要主要计算了释放状态后的值，如果为0则完全释放，返回true，反之仅是设置状态，返回false。</p>
<h2 id="测试用例"><a href="#测试用例" class="headerlink" title="测试用例"></a>测试用例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">import org.junit.Test;</div><div class="line"></div><div class="line">import java.util.concurrent.locks.Lock;</div><div class="line">import java.util.concurrent.locks.ReentrantLock;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by dx on 2017/9/12.</div><div class="line"> */</div><div class="line">public class ReentrantLockTest &#123;</div><div class="line">    //公平锁</div><div class="line">    private static Lock fairLock = new ReentrantLock(true);</div><div class="line">    //非公平锁</div><div class="line">    private static Lock unfairLock = new ReentrantLock();</div><div class="line"></div><div class="line">    @Test</div><div class="line">    public void fair() &#123;</div><div class="line">        System.out.println(&quot;fair version&quot;);</div><div class="line"></div><div class="line">        for (int i = 0; i &lt; 5; i++) &#123;</div><div class="line">            Thread thread = new Thread(new Job(fairLock));</div><div class="line">            //设置线程名字</div><div class="line">            thread.setName(&quot;&quot; + i);</div><div class="line">            thread.start();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(5000);</div><div class="line">        &#125; catch (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Test</div><div class="line">    public void unfair() &#123;</div><div class="line">        System.out.println(&quot;unfair version&quot;);</div><div class="line">        for (int i = 0; i &lt; 5; i++) &#123;</div><div class="line">            Thread thread = new Thread(new Job(unfairLock));</div><div class="line">            thread.setName(&quot;&quot; + i);</div><div class="line">            thread.start();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(5000);</div><div class="line">        &#125; catch (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static class Job implements Runnable &#123;</div><div class="line">        private Lock lock;</div><div class="line">        public Job(Lock lock) &#123;</div><div class="line">            this.lock = lock;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            for (int i = 0; i &lt; 5; i++) &#123;</div><div class="line">                lock.lock();</div><div class="line">                try &#123;</div><div class="line">                    System.out.println(&quot;Lock by:&quot;</div><div class="line">                            + Thread.currentThread().getName());</div><div class="line">                &#125; finally &#123;</div><div class="line">                    System.out.println(&quot;unLock by:&quot;+Thread.currentThread().getName());</div><div class="line">                    lock.unlock();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="返回结果："><a href="#返回结果：" class="headerlink" title="返回结果："></a>返回结果：</h3><ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">fair version</div><div class="line">Lock by:0</div><div class="line">Lock by:1</div><div class="line">Lock by:2</div><div class="line">Lock by:0</div><div class="line">Lock by:3</div><div class="line">Lock by:4</div><div class="line">Lock by:1</div><div class="line">Lock by:2</div><div class="line">Lock by:0</div><div class="line">Lock by:3</div><div class="line">Lock by:4</div><div class="line">Lock by:1</div><div class="line">Lock by:2</div><div class="line">Lock by:0</div><div class="line">Lock by:3</div><div class="line">Lock by:4</div><div class="line">Lock by:1</div><div class="line">Lock by:2</div><div class="line">Lock by:0</div><div class="line">Lock by:3</div><div class="line">Lock by:4</div><div class="line">Lock by:1</div><div class="line">Lock by:2</div><div class="line">Lock by:3</div><div class="line">Lock by:4</div></pre></td></tr></table></figure>
</li>
<li></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">unfair version</div><div class="line">Lock by:0</div><div class="line">Lock by:0</div><div class="line">Lock by:0</div><div class="line">Lock by:2</div><div class="line">Lock by:2</div><div class="line">Lock by:2</div><div class="line">Lock by:2</div><div class="line">Lock by:2</div><div class="line">Lock by:0</div><div class="line">Lock by:0</div><div class="line">Lock by:1</div><div class="line">Lock by:1</div><div class="line">Lock by:1</div><div class="line">Lock by:1</div><div class="line">Lock by:1</div><div class="line">Lock by:3</div><div class="line">Lock by:3</div><div class="line">Lock by:3</div><div class="line">Lock by:3</div><div class="line">Lock by:3</div><div class="line">Lock by:4</div><div class="line">Lock by:4</div><div class="line">Lock by:4</div><div class="line">Lock by:4</div><div class="line">Lock by:4</div></pre></td></tr></table></figure>
<h3 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h3><p>仔细观察返回的结果(其中每个数字代表一个线程)，非公平的结果一个线程连续获取锁的情况非常多，而公平的结果连续获取的情况基本没有。那么在一个线程获取了锁的那一刻，究竟锁的公平性会导致锁有什么样的处理逻辑呢？<br>通过之前的同步器(AbstractQueuedSynchronizer)的介绍，在锁上是存在一个等待队列，sync队列，我们通过复写ReentrantLock的获取当前锁的sync队列，输出在ReentrantLock被获取时刻，当前的sync队列的状态。</p>
<h2 id="测试用例2"><a href="#测试用例2" class="headerlink" title="测试用例2"></a>测试用例2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line">import org.junit.Test;</div><div class="line"></div><div class="line">import java.util.Collection;</div><div class="line">import java.util.concurrent.locks.Lock;</div><div class="line">import java.util.concurrent.locks.ReentrantLock;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by dx on 2017/9/12.</div><div class="line"> */</div><div class="line">public class ReentrantLockTest2 &#123;</div><div class="line">    private static Lock fairLock = new ReentrantLock2(true);</div><div class="line">    private static Lock unfairLock = new ReentrantLock2();</div><div class="line"></div><div class="line">    @Test</div><div class="line">    public void fair() &#123;</div><div class="line">        System.out.println(&quot;fair version&quot;);</div><div class="line">        for (int i = 0; i &lt; 5; i++) &#123;</div><div class="line">            Thread thread = new Thread(new Job(fairLock)) &#123;</div><div class="line">                public String toString() &#123;</div><div class="line">                    return getName();</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">            thread.setName(&quot;&quot; + i);</div><div class="line">            thread.start();</div><div class="line">        &#125;</div><div class="line">        // sleep 5000ms</div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(5000);</div><div class="line">        &#125; catch (InterruptedException ex) &#123;</div><div class="line">            ex.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Test</div><div class="line">    public void unfair() &#123;</div><div class="line">        System.out.println(&quot;unfair version&quot;);</div><div class="line">        for (int i = 0; i &lt; 5; i++) &#123;</div><div class="line">            Thread thread = new Thread(new Job(unfairLock)) &#123;</div><div class="line">                public String toString() &#123;</div><div class="line">                    return getName();</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">            thread.setName(&quot;&quot; + i);</div><div class="line">            thread.start();</div><div class="line">        &#125;</div><div class="line">        // sleep 5000ms</div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(5000);</div><div class="line">        &#125; catch (InterruptedException ex) &#123;</div><div class="line">            ex.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static class Job implements Runnable &#123;</div><div class="line">        private Lock lock;</div><div class="line"></div><div class="line">        public Job(Lock lock) &#123;</div><div class="line">            this.lock = lock;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            for (int i = 0; i &lt; 5; i++) &#123;</div><div class="line">                lock.lock();</div><div class="line">                try &#123;</div><div class="line">                    System.out.println(&quot;Lock by:&quot;</div><div class="line">                            + Thread.currentThread().getName() + &quot; and &quot;</div><div class="line">                            + ((ReentrantLock2) lock).getQueuedThreads()</div><div class="line">                            + &quot; waits.&quot;);</div><div class="line">                &#125; finally &#123;</div><div class="line">                    lock.unlock();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static class ReentrantLock2 extends ReentrantLock &#123;</div><div class="line">        // Constructor Override</div><div class="line"></div><div class="line">        public ReentrantLock2(boolean flag) &#123;</div><div class="line">            super(flag);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        public ReentrantLock2() &#123;</div><div class="line">            super();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        private static final long serialVersionUID = 1773716895097002072L;</div><div class="line"></div><div class="line">        public Collection&lt;Thread&gt; getQueuedThreads() &#123;</div><div class="line">            return super.getQueuedThreads();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="返回结果：-1"><a href="#返回结果：-1" class="headerlink" title="返回结果："></a>返回结果：</h3><ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">fair version</div><div class="line">fair version</div><div class="line">Lock by:1 and [0] waits.</div><div class="line">Lock by:0 and [1, 4, 3, 2] waits.</div><div class="line">Lock by:2 and [0, 1, 4, 3] waits.</div><div class="line">Lock by:3 and [2, 0, 1, 4] waits.</div><div class="line">Lock by:4 and [3, 2, 0, 1] waits.</div><div class="line">Lock by:1 and [4, 3, 2, 0] waits.</div><div class="line">Lock by:0 and [1, 4, 3, 2] waits.</div><div class="line">Lock by:2 and [0, 1, 4, 3] waits.</div><div class="line">Lock by:3 and [2, 0, 1, 4] waits.</div><div class="line">Lock by:4 and [3, 2, 0, 1] waits.</div><div class="line">Lock by:1 and [4, 3, 2, 0] waits.</div><div class="line">Lock by:0 and [1, 4, 3, 2] waits.</div><div class="line">Lock by:2 and [0, 1, 4, 3] waits.</div><div class="line">Lock by:3 and [2, 0, 1, 4] waits.</div><div class="line">Lock by:4 and [3, 2, 0, 1] waits.</div><div class="line">Lock by:1 and [4, 3, 2, 0] waits.</div><div class="line">Lock by:0 and [1, 4, 3, 2] waits.</div><div class="line">Lock by:2 and [0, 1, 4, 3] waits.</div><div class="line">Lock by:3 and [2, 0, 1, 4] waits.</div><div class="line">Lock by:4 and [3, 2, 0, 1] waits.</div><div class="line">Lock by:1 and [4, 3, 2, 0] waits.</div><div class="line">Lock by:0 and [4, 3, 2] waits.</div><div class="line">Lock by:2 and [4, 3] waits.</div><div class="line">Lock by:3 and [4] waits.</div><div class="line">Lock by:4 and [] waits.</div></pre></td></tr></table></figure>
</li>
<li></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">unfair version</div><div class="line">Lock by:0 and [] waits.</div><div class="line">Lock by:0 and [] waits.</div><div class="line">Lock by:0 and [1] waits.</div><div class="line">Lock by:2 and [1] waits.</div><div class="line">Lock by:2 and [3, 1] waits.</div><div class="line">Lock by:2 and [3, 1] waits.</div><div class="line">Lock by:2 and [0, 3, 1] waits.</div><div class="line">Lock by:2 and [0, 3, 1] waits.</div><div class="line">Lock by:1 and [0, 3] waits.</div><div class="line">Lock by:1 and [4, 0, 3] waits.</div><div class="line">Lock by:1 and [4, 0, 3] waits.</div><div class="line">Lock by:1 and [4, 0, 3] waits.</div><div class="line">Lock by:1 and [4, 0, 3] waits.</div><div class="line">Lock by:3 and [4, 0] waits.</div><div class="line">Lock by:3 and [4, 0] waits.</div><div class="line">Lock by:3 and [4, 0] waits.</div><div class="line">Lock by:3 and [4, 0] waits.</div><div class="line">Lock by:3 and [4, 0] waits.</div><div class="line">Lock by:0 and [4] waits.</div><div class="line">Lock by:0 and [4] waits.</div><div class="line">Lock by:4 and [] waits.</div><div class="line">Lock by:4 and [] waits.</div><div class="line">Lock by:4 and [] waits.</div><div class="line">Lock by:4 and [] waits.</div><div class="line">Lock by:4 and [] waits.</div></pre></td></tr></table></figure>
<h3 id="结果分析-1"><a href="#结果分析-1" class="headerlink" title="结果分析"></a>结果分析</h3><p>可以明显看出，在非公平获取的过程中，“插队”现象非常严重，后续获取锁的线程根本不顾及sync队列中等待的线程，而是能获取就获取。反观公平获取的过程，锁的获取就类似线性化的，每次都由sync队列中等待最长的线程（链表的第一个，sync队列是由尾部结点添加，当前输出的sync队列是逆序输出）获取锁。一个 hasQueuedPredecessors方法能够获得公平性的特性，这点实际上是由AbstractQueuedSynchronizer来完成的，看一下acquire方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public final void acquire(int arg) &#123;</div><div class="line">	if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</div><div class="line">		selfInterrupt();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到，如果获取状态和在sync队列中排队是短路的判断，也就是说如果tryAcquire成功，那么是不会进入sync队列的，可以通过下图来深刻的认识公平性和AbstractQueuedSynchronizer的获取过程。<br>非公平的，或者说默认的获取方式如下图所示：</p>
<p>对于状态的获取，可以快速的通过tryAcquire的成功，也就是黄色的Fast路线，也可以由于tryAcquire的失败，构造节点，进入sync队列中排序后再次获取。因此可以理解为Fast就是一个快速通道，当例子中的线程释放锁之后，快速的通过Fast通道再次获取锁，就算当前sync队列中有排队等待的线程也会被忽略。这种模式，可以保证进入和退出锁的吞吐量，但是sync队列中过早排队的线程会一直处于阻塞状态，造成“饥饿”场景。</p>
<p><img src="http://ifeve.com/wp-content/uploads/2013/12/Untitled.png" alt=""></p>
<p>而公平性锁，就是在tryAcquire的调用中顾及当前sync队列中的等待节点（废弃了Fast通道），也就是任意请求都需要按照sync队列中既有的顺序进行，先到先得。这样很好的确保了公平性，但是可以从结果中看到，吞吐量就没有非公平的锁高了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/雄.png"
              alt="NobiGo" />
          
            <p class="site-author-name" itemprop="name">NobiGo</p>
            <p class="site-description motion-element" itemprop="description">愿你出走半生，归来依旧少年</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">NobiGo</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
